# Stage Idol Calendar - Apache Configuration

# Clean URLs
<IfModule mod_rewrite.c>
    RewriteEngine On

    # Event path with subpage: /event/slug/credits → credits.php?event=slug
    RewriteRule ^event/([^/]+)/([^/]+)$ $2.php?event=$1 [L,QSA]

    # Event path main page: /event/slug → index.php?event=slug
    RewriteRule ^event/([^/]+)/?$ index.php?event=$1 [L,QSA]

    # Remove .php extension (public pages only, not admin)
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} !^/admin/
    RewriteRule ^([^/]+)$ $1.php [L,QSA]

    # api/ subdirectory (api/request)
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^api/([^/]+)$ api/$1.php [L,QSA]
</IfModule>

# --- Security Configuration ---

# ป้องกันการเข้าถึงไฟล์ database
<FilesMatch "\.(db|sqlite|sqlite3)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# ป้องกันการเข้าถึงไฟล์ config ที่มี sensitive data
<FilesMatch "^\.">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# ป้องกัน directory listing
Options -Indexes

# ป้องกันการเข้าถึงไฟล์ .md
<FilesMatch "\.(md)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Security Headers (สำรองกรณี PHP ไม่ทำงาน)
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>
